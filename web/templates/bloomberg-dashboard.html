<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Nickberg Terminal</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’¸</text></svg>">
    <link rel="stylesheet" href="/static/css/bloomberg-theme.css?v=1000">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Force ticker visibility - debug styles */
        .news-ticker-container {
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
            z-index: 9999 !important;
        }
        /* Hide any lingering chart elements */
        #sentimentChart, .chart-container, .mini-chart, canvas {
            display: none !important;
            visibility: hidden !important;
        }
    </style>
    <script>
        // Clear any service workers and force reload if needed
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
                for(let registration of registrations) {
                    registration.unregister();
                }
            });
        }
    </script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-radar"></i>
                <h1>NICKBERG TERMINAL</h1>
            </div>
            <div class="keyboard-hint" onclick="toggleHelpOverlay()">
                <i class="fas fa-keyboard"></i>
                <span>Press <kbd>?</kbd> for shortcuts</span>
            </div>
            <div class="header-actions">
                <button id="compareBtn" class="btn" title="Compare Stocks" onclick="openCompareModal()">
                    <i class="fas fa-columns"></i> COMPARE
                </button>
                <button id="screenerBtn" class="btn" title="Stock Screener">
                    <i class="fas fa-filter"></i> SCREENER
                </button>
                <button id="searchBtn" class="btn search-btn" title="Search (Ctrl+K)">
                    <i class="fas fa-search"></i>
                    <span class="search-shortcut">Ctrl+K</span>
                </button>
                <button id="refreshBtn" class="btn">
                    <i class="fas fa-sync-alt"></i> REFRESH
                </button>
                <button id="runBotBtn" class="btn">
                    <i class="fas fa-play"></i> RUN NOW
                </button>
            </div>
        </header>

        <!-- Bloomberg-style Command Line -->
        <div class="command-bar">
            <span class="command-prompt">&gt;</span>
            <input type="text" id="commandInput" class="command-input" placeholder="Enter ticker (e.g., AAPL) or function..." autocomplete="off">
            <button class="command-btn" onclick="executeCommand()">
                <i class="fas fa-arrow-right"></i>
            </button>
            <div class="command-help">
                <kbd>ENTER</kbd> to search | <kbd>ESC</kbd> to close
            </div>
        </div>

        <!-- Stock Details Panel (hidden by default) -->
        <div id="stockDetailsPanel" class="stock-details-panel" style="display: none;">
            <div class="stock-details-header">
                <div class="stock-main-info">
                    <span class="stock-detail-symbol" id="detailSymbol">AAPL</span>
                    <span class="stock-detail-name" id="detailName">Apple Inc.</span>
                </div>
                <div class="stock-main-price">
                    <span class="stock-detail-price" id="detailPrice">$150.25</span>
                    <span class="stock-detail-change" id="detailChange">â–² +2.50 (+1.69%)</span>
                </div>
                <button class="stock-details-close" onclick="closeStockDetails()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="stock-details-grid">
                <div class="stock-stat">
                    <span class="stat-label">Day High</span>
                    <span class="stat-value" id="detailHigh">152.30</span>
                </div>
                <div class="stock-stat">
                    <span class="stat-label">Day Low</span>
                    <span class="stat-value" id="detailLow">148.90</span>
                </div>
                <div class="stock-stat">
                    <span class="stat-label">Volume</span>
                    <span class="stat-value" id="detailVolume">45.2M</span>
                </div>
                <div class="stock-stat">
                    <span class="stat-label">Avg Volume</span>
                    <span class="stat-value" id="detailAvgVol">52.1M</span>
                </div>
                <div class="stock-stat">
                    <span class="stat-label">Market Cap</span>
                    <span class="stat-value" id="detailMarketCap">$2.4T</span>
                </div>
                <div class="stock-stat">
                    <span class="stat-label">P/E Ratio</span>
                    <span class="stat-value" id="detailPE">28.5</span>
                </div>
            </div>
            <div class="stock-mentions-section" id="detailMentionsSection">
                <div class="section-title">RECENT MENTIONS (<span id="detailMentionsCount">0</span>)</div>
                <div class="stock-mentions-list" id="detailMentionsList">
                    <!-- Mentions populated dynamically -->
                </div>
            </div>
        </div>

        <!-- Status Bar - Key Stats -->
        <div class="status-bar-top">
            <div class="stat-item">
                <span class="stat-label">ARTICLES:</span>
                <span class="stat-value" id="totalArticles">-</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">MENTIONS:</span>
                <span class="stat-value" id="totalMentions">-</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">ALERTS:</span>
                <span class="stat-value red" id="totalAlerts">-</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">24H:</span>
                <span class="stat-value green" id="articles24h">-</span>
            </div>
            <div class="stat-item" style="margin-left: auto;">
                <span class="stat-label">LAST:</span>
                <span class="stat-value" id="lastUpdated">--:--:--</span>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="dashboard">
                <i class="fas fa-chart-line"></i> DASHBOARD
            </button>
            <button class="nav-tab" data-tab="settings">
                <i class="fas fa-cog"></i> SETTINGS
            </button>
        </nav>

        <!-- Dashboard Tab Content -->
        <div id="dashboardTab" class="tab-content active">
            <!-- Main Terminal Grid -->
            <div class="terminal-grid">
                <!-- Articles Feed Panel -->
                <div class="panel articles-panel">
                    <div class="panel-header">
                        <h2><i class="fas fa-newspaper"></i> ARTICLES FEED</h2>
                        <div class="article-header-controls">
                            <div class="sentiment-filter-buttons" id="sentimentFilters">
                                <button class="sentiment-filter-btn active" data-sentiment="all" title="All articles">ALL</button>
                                <button class="sentiment-filter-btn positive" data-sentiment="positive" title="Positive sentiment"><i class="fas fa-smile"></i></button>
                                <button class="sentiment-filter-btn neutral" data-sentiment="neutral" title="Neutral sentiment"><i class="fas fa-meh"></i></button>
                                <button class="sentiment-filter-btn negative" data-sentiment="negative" title="Negative sentiment"><i class="fas fa-frown"></i></button>
                            </div>
                            <select id="articleFilter" class="filter-select">
                                <option value="all">ALL SOURCES</option>
                            </select>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div id="articlesList" class="articles-list">
                            <div class="loading">LOADING ARTICLES...</div>
                        </div>
                    </div>
                </div>

                <!-- Market Monitor Panel (Bloomberg-style) -->
                <div class="panel">
                    <div class="panel-header">
                        <h2><i class="fas fa-globe"></i> MARKET MONITOR</h2>
                        <span class="badge" id="marketStatus">LIVE</span>
                    </div>
                    <div class="panel-body">
                        <div class="market-monitor">
                            <!-- Major Indices -->
                            <div class="market-section">
                                <div class="section-header">INDICES</div>
                                <div id="indicesList" class="indices-list">
                                    <div class="market-item">
                                        <span class="market-symbol">SPX</span>
                                        <span class="market-price">--.--</span>
                                        <span class="market-change flat">--.--</span>
                                    </div>
                                    <div class="market-item">
                                        <span class="market-symbol">DJI</span>
                                        <span class="market-price">--.--</span>
                                        <span class="market-change flat">--.--</span>
                                    </div>
                                    <div class="market-item">
                                        <span class="market-symbol">IXIC</span>
                                        <span class="market-price">--.--</span>
                                        <span class="market-change flat">--.--</span>
                                    </div>
                                    <div class="market-item">
                                        <span class="market-symbol">RUT</span>
                                        <span class="market-price">--.--</span>
                                        <span class="market-change flat">--.--</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Gainers/Losers Toggle -->
                            <div class="market-tabs">
                                <button class="market-tab active" data-tab="gainers">GAINERS</button>
                                <button class="market-tab" data-tab="losers">LOSERS</button>
                                <button class="market-tab" data-tab="active">MOST ACTIVE</button>
                            </div>
                            
                            <div id="marketMovers" class="movers-list">
                                <div class="loading">LOADING...</div>
                            </div>

                            <!-- Economic Calendar -->
                            <div class="economic-calendar-section">
                                <div class="section-header" style="margin-top: 12px;">
                                    <i class="fas fa-calendar-alt"></i> ECONOMIC CALENDAR
                                </div>
                                <div id="economicCalendar" class="economic-calendar-list">
                                    <div class="loading">LOADING EVENTS...</div>
                                </div>
                            </div>

                            <!-- Trending Tickers -->
                            <div class="trending-tickers-section">
                                <div class="section-header" style="margin-top: 12px;">
                                    <i class="fas fa-fire"></i> TRENDING TICKERS
                                </div>
                                <div id="trendingTickersList" class="trending-tickers-list">
                                    <div class="loading">LOADING...</div>
                                </div>
                            </div>

                            <!-- Sentiment Trend Mini-Chart -->
                            <div class="sentiment-trend-section">
                                <div class="section-header" style="margin-top: 12px;">
                                    <i class="fas fa-chart-area"></i> SENTIMENT TREND
                                </div>
                                <div id="sentimentTrendChart" class="sentiment-trend-chart">
                                    <div class="sentiment-bars" id="sentimentBars">
                                        <div class="loading">LOADING...</div>
                                    </div>
                                    <div class="sentiment-summary" id="sentimentSummary">
                                        <span class="sentiment-label bullish" id="sentimentMood">--</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bluesky Financial Feed Panel (Full Size) -->
                <div class="panel bluesky-panel-full">
                    <div class="panel-header">
                        <h2><i class="fas fa-cloud"></i> BLUESKY FINANCE</h2>
                        <span class="badge" style="background: #1185fe; color: white;">LIVE</span>
                    </div>
                    <div class="panel-body" style="padding: 0;">
                        <div class="bluesky-feed-full" id="blueskyFeedFull">
                            <div class="bluesky-loading">
                                <i class="fas fa-spinner fa-spin"></i>
                                <span>Loading Bluesky feed...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scrolling News Ticker -->
            <div class="news-ticker-container" id="newsTickerContainer">
                <div class="ticker-label">MARKETS</div>
                <div class="ticker-scroll">
                    <div class="ticker-content" id="newsTicker">
                        <span class="stock-ticker-item">
                            <span class="stock-symbol">LOADING</span>
                            <span class="stock-price">--.--</span>
                            <span class="stock-change flat">â€”0.00%</span>
                        </span>
                    </div>
                </div>
                <div class="ticker-controls">
                    <button id="pauseTicker" title="Pause/Resume">
                        <i class="fas fa-pause"></i>
                    </button>
                </div>
            </div>

            <!-- Bottom Status Bar -->
            <div class="status-bar">
                <span id="systemStatus">SYSTEM READY</span>
                <span style="color: var(--accent-orange); font-size: 11px;">v2.0 - NICKBERG TERMINAL</span>
                <span id="statusIndicator" class="status">
                    <i class="fas fa-circle"></i> CONNECTED
                </span>
            </div>
        </div>

        <!-- Settings Tab Content -->
        <div id="settingsTab" class="tab-content">
            <div class="settings-container">
                <!-- Watchlist Management -->
                <div class="settings-section">
                    <div class="settings-section-header">
                        <h3><i class="fas fa-list"></i> WATCHLIST MANAGEMENT</h3>
                    </div>
                    <div class="settings-section-body">
                        <p class="setting-label-hint" style="margin-bottom: 12px;">
                            Add or remove companies from your monitoring watchlist.
                        </p>
                        <div class="tag-input-container">
                            <div id="watchlistTags" class="tag-list">
                                <!-- Tags will be populated dynamically -->
                            </div>
                            <div class="tag-add-form">
                                <input type="text" id="tickerInput" placeholder="TICKER (e.g., AAPL)" maxlength="5">
                                <input type="text" id="namesInput" placeholder="NAMES (comma-separated)">
                                <button type="button" class="btn" id="addTickerBtn">
                                    <i class="fas fa-plus"></i> ADD
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Alert Channels -->
                <div class="settings-section">
                    <div class="settings-section-header">
                        <h3><i class="fas fa-bell"></i> ALERT CHANNELS</h3>
                    </div>
                    <div class="settings-section-body">
                        <div class="setting-row">
                            <div class="setting-label">
                                <span class="setting-label-text">Console Output</span>
                                <span class="setting-label-hint">Display alerts in terminal</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="channelConsole" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-row">
                            <div class="setting-label">
                                <span class="setting-label-text">File Logging</span>
                                <span class="setting-label-hint">Save alerts to log file</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="channelFile" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-row">
                            <div class="setting-label">
                                <span class="setting-label-text">Telegram Notifications</span>
                                <span class="setting-label-hint">Send alerts via Telegram bot</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="channelTelegram">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-row">
                            <div class="setting-label">
                                <span class="setting-label-text">Webhook</span>
                                <span class="setting-label-hint">POST alerts to external webhook</span>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="channelWebhook">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Severity Routing -->
                <div class="settings-section">
                    <div class="settings-section-header">
                        <h3><i class="fas fa-route"></i> SEVERITY ROUTING</h3>
                    </div>
                    <div class="settings-section-body">
                        <p class="setting-label-hint" style="margin-bottom: 12px;">
                            Configure which channels receive alerts for each severity level.
                        </p>
                        <table class="routing-table">
                            <thead>
                                <tr>
                                    <th>SEVERITY</th>
                                    <th>CONSOLE</th>
                                    <th>FILE</th>
                                    <th>TELEGRAM</th>
                                    <th>WEBHOOK</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><span class="severity-label high"><i class="fas fa-exclamation-circle"></i> HIGH</span></td>
                                    <td><input type="checkbox" class="routing-checkbox" data-severity="high" data-channel="console" checked></td>
                                    <td><input type="checkbox" class="routing-checkbox" data-severity="high" data-channel="file" checked></td>
                                    <td><input type="checkbox" class="routing-checkbox" data-severity="high" data-channel="telegram" checked></td>
                                    <td><input type="checkbox" class="routing-checkbox" data-severity="high" data-channel="webhook" checked></td>
                                </tr>
                                <tr>
                                    <td><span class="severity-label medium"><i class="fas fa-exclamation-triangle"></i> MEDIUM</span></td>
                                    <td><input type="checkbox" class="routing-checkbox" data-severity="medium" data-channel="console" checked></td>
                                    <td><input type="checkbox" class="routing-checkbox" data-severity="medium" data-channel="file" checked></td>
                                    <td><input type="checkbox" class="routing-checkbox" data-severity="medium" data-channel="telegram"></td>
                                    <td><input type="checkbox" class="routing-checkbox" data-severity="medium" data-channel="webhook"></td>
                                </tr>
                                <tr>
                                    <td><span class="severity-label low"><i class="fas fa-info-circle"></i> LOW</span></td>
                                    <td><input type="checkbox" class="routing-checkbox" data-severity="low" data-channel="console"></td>
                                    <td><input type="checkbox" class="routing-checkbox" data-severity="low" data-channel="file" checked></td>
                                    <td><input type="checkbox" class="routing-checkbox" data-severity="low" data-channel="telegram"></td>
                                    <td><input type="checkbox" class="routing-checkbox" data-severity="low" data-channel="webhook"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pattern Thresholds -->
                <div class="settings-section">
                    <div class="settings-section-header">
                        <h3><i class="fas fa-sliders-h"></i> PATTERN THRESHOLDS</h3>
                    </div>
                    <div class="settings-section-body">
                        <div class="setting-row">
                            <div class="setting-label">
                                <span class="setting-label-text">Volume Spike Threshold</span>
                                <span class="setting-label-hint">Multiplier vs 7-day average to trigger alert</span>
                            </div>
                            <div class="slider-container">
                                <input type="range" class="slider-input" id="volumeThreshold" min="1" max="10" step="0.5" value="3">
                                <span class="slider-value" id="volumeThresholdValue">3.0x</span>
                            </div>
                        </div>
                        <div class="setting-row">
                            <div class="setting-label">
                                <span class="setting-label-text">Minimum Articles</span>
                                <span class="setting-label-hint">Minimum articles required to trigger alert</span>
                            </div>
                            <input type="number" class="number-input" id="minArticles" min="1" max="50" value="3">
                        </div>
                        <div class="setting-row">
                            <div class="setting-label">
                                <span class="setting-label-text">Sentiment Shift Threshold</span>
                                <span class="setting-label-hint">Minimum sentiment change to trigger alert</span>
                            </div>
                            <div class="slider-container">
                                <input type="range" class="slider-input" id="sentimentThreshold" min="0.1" max="1" step="0.1" value="0.3">
                                <span class="slider-value" id="sentimentThresholdValue">0.3</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Per-Company Preferences -->
                <div class="settings-section">
                    <div class="settings-section-header">
                        <h3><i class="fas fa-building"></i> PER-COMPANY PREFERENCES</h3>
                    </div>
                    <div class="settings-section-body">
                        <p class="setting-label-hint" style="margin-bottom: 12px;">
                            Configure alert settings for specific companies. Leave empty to use default settings.
                        </p>
                        <div id="companyPreferences" class="settings-grid">
                            <!-- Company preference cards will be populated dynamically -->
                        </div>
                        <div id="noCompanyPrefs" class="empty-state" style="padding: 16px;">
                            <p>Add companies to the watchlist to configure per-company preferences.</p>
                        </div>
                    </div>
                </div>

                <!-- Save Button -->
                <div class="save-btn-container">
                    <button type="button" class="btn-save" id="saveSettingsBtn">
                        <i class="fas fa-save"></i> SAVE SETTINGS
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Stock Detail Modal -->
    <div id="stockDetailModal" class="stock-detail-modal" style="display: none;">
        <div class="stock-modal-overlay" onclick="closeStockModal()"></div>
        <div class="stock-modal-content">
            <div class="stock-modal-header">
                <div class="stock-modal-title">
                    <span class="stock-modal-symbol" id="modalSymbol">AAPL</span>
                    <span class="stock-modal-name" id="modalName">Apple Inc.</span>
                </div>
                <div class="stock-modal-price">
                    <span class="stock-modal-price-value" id="modalPrice">$185.42</span>
                    <span class="stock-modal-change" id="modalChange">â–² +2.35 (+1.28%)</span>
                </div>
                <button class="stock-modal-close" onclick="closeStockModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Tab Navigation -->
            <div class="stock-modal-tabs">
                <button class="stock-tab active" data-tab="overview" onclick="switchStockTab('overview')">Overview</button>
                <button class="stock-tab" data-tab="valuation" onclick="switchStockTab('valuation')">Valuation</button>
                <button class="stock-tab" data-tab="financials" onclick="switchStockTab('financials')">Financials</button>
                <button class="stock-tab" data-tab="options" onclick="switchStockTab('options')">Options</button>
                <button class="stock-tab" data-tab="ownership" onclick="switchStockTab('ownership')">Ownership</button>
                <button class="stock-tab" data-tab="insiders" onclick="switchStockTab('insiders')">Insiders</button>
                <button class="stock-tab" data-tab="analysts" onclick="switchStockTab('analysts')">Analysts</button>
            </div>

            <!-- Overview Tab -->
            <div class="stock-tab-content active" id="tab-overview">
                <div class="stock-modal-stats">
                    <div class="stat-box">
                        <span class="stat-box-label">Market Cap</span>
                        <span class="stat-box-value" id="modalMarketCap">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Volume</span>
                        <span class="stat-box-value" id="modalVolume">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Avg Volume</span>
                        <span class="stat-box-value" id="modalAvgVol">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Beta</span>
                        <span class="stat-box-value" id="modalBeta">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">52W High</span>
                        <span class="stat-box-value" id="modal52High">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">52W Low</span>
                        <span class="stat-box-value" id="modal52Low">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Open</span>
                        <span class="stat-box-value" id="modalOpen">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Prev Close</span>
                        <span class="stat-box-value" id="modalPrevClose">--</span>
                    </div>
                </div>
                <div class="stock-modal-stats" style="margin-top: 8px;">
                    <div class="stat-box">
                        <span class="stat-box-label">50D Avg</span>
                        <span class="stat-box-value" id="modal50DayAvg">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">200D Avg</span>
                        <span class="stat-box-value" id="modal200DayAvg">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">52W Change</span>
                        <span class="stat-box-value" id="modal52WChange">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Bid / Ask</span>
                        <span class="stat-box-value" id="modalBidAsk">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Day Range</span>
                        <span class="stat-box-value" id="modalDayRange">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">EPS (TTM)</span>
                        <span class="stat-box-value" id="modalEPS">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Dividend</span>
                        <span class="stat-box-value" id="modalDivYield">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Earnings Date</span>
                        <span class="stat-box-value" id="modalEarningsDate">--</span>
                    </div>
                </div>
            </div>

            <!-- Valuation Tab -->
            <div class="stock-tab-content" id="tab-valuation">
                <div class="stock-section-header"><i class="fas fa-chart-pie"></i> Valuation Metrics</div>
                <div class="stock-modal-stats">
                    <div class="stat-box">
                        <span class="stat-box-label">P/E (TTM)</span>
                        <span class="stat-box-value" id="modalPE">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Forward P/E</span>
                        <span class="stat-box-value" id="modalForwardPE">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">PEG Ratio</span>
                        <span class="stat-box-value" id="modalPEG">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Price/Book</span>
                        <span class="stat-box-value" id="modalPB">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Price/Sales</span>
                        <span class="stat-box-value" id="modalPS">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">EV/Revenue</span>
                        <span class="stat-box-value" id="modalEVRevenue">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">EV/EBITDA</span>
                        <span class="stat-box-value" id="modalEVEBITDA">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Ent. Value</span>
                        <span class="stat-box-value" id="modalEV">--</span>
                    </div>
                </div>
                <div class="stock-section-header" style="margin-top: 12px;"><i class="fas fa-chart-line"></i> Growth Metrics</div>
                <div class="stock-modal-stats">
                    <div class="stat-box">
                        <span class="stat-box-label">Revenue Growth</span>
                        <span class="stat-box-value" id="modalRevGrowth">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Earnings Growth</span>
                        <span class="stat-box-value" id="modalEarningsGrowth">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Quarterly Growth</span>
                        <span class="stat-box-value" id="modalQtrGrowth">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Forward EPS</span>
                        <span class="stat-box-value" id="modalForwardEPS">--</span>
                    </div>
                </div>
            </div>

            <!-- Financials Tab -->
            <div class="stock-tab-content" id="tab-financials">
                <div class="stock-section-header"><i class="fas fa-percentage"></i> Profitability</div>
                <div class="stock-modal-stats">
                    <div class="stat-box">
                        <span class="stat-box-label">Profit Margin</span>
                        <span class="stat-box-value" id="modalProfitMargin">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Operating Margin</span>
                        <span class="stat-box-value" id="modalOpMargin">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Gross Margin</span>
                        <span class="stat-box-value" id="modalGrossMargin">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">EBITDA Margin</span>
                        <span class="stat-box-value" id="modalEBITDAMargin">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">ROE</span>
                        <span class="stat-box-value" id="modalROE">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">ROA</span>
                        <span class="stat-box-value" id="modalROA">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Revenue</span>
                        <span class="stat-box-value" id="modalRevenue">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Net Income</span>
                        <span class="stat-box-value" id="modalNetIncome">--</span>
                    </div>
                </div>
                <div class="stock-section-header" style="margin-top: 12px;"><i class="fas fa-balance-scale"></i> Balance Sheet</div>
                <div class="stock-modal-stats">
                    <div class="stat-box">
                        <span class="stat-box-label">Total Cash</span>
                        <span class="stat-box-value" id="modalTotalCash">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Total Debt</span>
                        <span class="stat-box-value" id="modalTotalDebt">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Debt/Equity</span>
                        <span class="stat-box-value" id="modalDebtEquity">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Current Ratio</span>
                        <span class="stat-box-value" id="modalCurrentRatio">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Quick Ratio</span>
                        <span class="stat-box-value" id="modalQuickRatio">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Book Value</span>
                        <span class="stat-box-value" id="modalBookValue">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Free Cash Flow</span>
                        <span class="stat-box-value" id="modalFCF">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Op. Cash Flow</span>
                        <span class="stat-box-value" id="modalOpCashFlow">--</span>
                    </div>
                </div>
                <div class="stock-section-header" style="margin-top: 12px;"><i class="fas fa-hand-holding-usd"></i> Dividends</div>
                <div class="stock-modal-stats">
                    <div class="stat-box">
                        <span class="stat-box-label">Dividend Rate</span>
                        <span class="stat-box-value" id="modalDivRate">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Dividend Yield</span>
                        <span class="stat-box-value" id="modalDivYieldPct">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Payout Ratio</span>
                        <span class="stat-box-value" id="modalPayoutRatio">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">5Y Avg Yield</span>
                        <span class="stat-box-value" id="modal5YAvgYield">--</span>
                    </div>
                </div>
            </div>

            <!-- Options Tab -->
            <div class="stock-tab-content" id="tab-options">
                <div class="options-header">
                    <div class="stock-section-header"><i class="fas fa-chart-area"></i> Options Chain</div>
                    <div class="options-controls">
                        <label for="optionsExpiration">Expiration:</label>
                        <select id="optionsExpiration" class="options-select" onchange="loadOptionsForExpiration()">
                            <option value="">Select expiration...</option>
                        </select>
                    </div>
                </div>
                <div id="optionsLoading" class="options-loading" style="display: none;">
                    <i class="fas fa-spinner fa-spin"></i> Loading options data...
                </div>
                <div id="optionsContent" class="options-content">
                    <div class="options-empty">
                        <i class="fas fa-chart-area"></i>
                        <p>Select an expiration date to view options chain</p>
                    </div>
                </div>
                <div id="optionsData" class="options-data" style="display: none;">
                    <div class="options-info">
                        <span id="optionsCurrentPrice">Current Price: --</span>
                    </div>
                    <div class="options-tables">
                        <div class="options-table-container">
                            <h4 class="options-table-title calls">CALLS</h4>
                            <div class="options-table-wrapper">
                                <table class="options-table" id="optionsCallsTable">
                                    <thead>
                                        <tr>
                                            <th>Strike</th>
                                            <th>Last</th>
                                            <th>Bid</th>
                                            <th>Ask</th>
                                            <th>Vol</th>
                                            <th>OI</th>
                                            <th>IV</th>
                                        </tr>
                                    </thead>
                                    <tbody id="optionsCallsBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="options-table-container">
                            <h4 class="options-table-title puts">PUTS</h4>
                            <div class="options-table-wrapper">
                                <table class="options-table" id="optionsPutsTable">
                                    <thead>
                                        <tr>
                                            <th>Strike</th>
                                            <th>Last</th>
                                            <th>Bid</th>
                                            <th>Ask</th>
                                            <th>Vol</th>
                                            <th>OI</th>
                                            <th>IV</th>
                                        </tr>
                                    </thead>
                                    <tbody id="optionsPutsBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ownership Tab -->
            <div class="stock-tab-content" id="tab-ownership">
                <div class="stock-section-header"><i class="fas fa-users"></i> Ownership Breakdown</div>
                <div class="stock-modal-stats">
                    <div class="stat-box">
                        <span class="stat-box-label">Insider Own %</span>
                        <span class="stat-box-value" id="modalInsiderOwn">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Inst. Own %</span>
                        <span class="stat-box-value" id="modalInstOwn">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Shares Out</span>
                        <span class="stat-box-value" id="modalSharesOut">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Float</span>
                        <span class="stat-box-value" id="modalFloat">--</span>
                    </div>
                </div>
                <div class="stock-section-header" style="margin-top: 12px;"><i class="fas fa-arrow-down"></i> Short Interest</div>
                <div class="stock-modal-stats">
                    <div class="stat-box">
                        <span class="stat-box-label">Short % Float</span>
                        <span class="stat-box-value" id="modalShortPct">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Short Ratio</span>
                        <span class="stat-box-value" id="modalShortRatio">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Shares Short</span>
                        <span class="stat-box-value" id="modalSharesShort">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Prior Month</span>
                        <span class="stat-box-value" id="modalSharesShortPrior">--</span>
                    </div>
                </div>
                <div class="stock-section-header" style="margin-top: 12px;"><i class="fas fa-building"></i> Top Institutional Holders</div>
                <div id="modalTopHolders" class="top-holders-list">
                    <div class="holder-placeholder">Loading holders data...</div>
                </div>
            </div>

            <!-- Insiders Tab -->
            <div class="stock-tab-content" id="tab-insiders">
                <div class="stock-section-header"><i class="fas fa-user-secret"></i> Recent Insider Transactions</div>
                <div id="modalInsiderTransactions" class="insider-transactions-list">
                    <div class="insider-placeholder">Loading insider transactions...</div>
                </div>
            </div>

            <!-- Analysts Tab -->
            <div class="stock-tab-content" id="tab-analysts">
                <div class="stock-section-header"><i class="fas fa-user-tie"></i> Analyst Consensus</div>
                <div class="analyst-summary">
                    <div class="analyst-rating-box">
                        <span class="analyst-rating-label">Rating</span>
                        <span class="analyst-rating-value" id="modalRecommendation">--</span>
                    </div>
                    <div class="analyst-rating-box">
                        <span class="analyst-rating-label"># Analysts</span>
                        <span class="analyst-rating-value" id="modalNumAnalysts">--</span>
                    </div>
                </div>
                <div class="stock-section-header" style="margin-top: 12px;"><i class="fas fa-bullseye"></i> Price Targets</div>
                <div class="stock-modal-stats">
                    <div class="stat-box">
                        <span class="stat-box-label">Target Mean</span>
                        <span class="stat-box-value" id="modalTargetPrice">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Target High</span>
                        <span class="stat-box-value" id="modalTargetHigh">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Target Low</span>
                        <span class="stat-box-value" id="modalTargetLow">--</span>
                    </div>
                    <div class="stat-box">
                        <span class="stat-box-label">Upside</span>
                        <span class="stat-box-value" id="modalUpside">--</span>
                    </div>
                </div>
            </div>
            
            <!-- Chart Section -->
            <div class="stock-modal-chart-section">
                <div class="chart-controls">
                    <div class="chart-period-controls">
                        <button class="chart-period-btn active" data-period="1d" onclick="changeChartPeriod('1d')">1D</button>
                        <button class="chart-period-btn" data-period="5d" onclick="changeChartPeriod('5d')">1W</button>
                        <button class="chart-period-btn" data-period="1mo" onclick="changeChartPeriod('1mo')">1M</button>
                        <button class="chart-period-btn" data-period="3mo" onclick="changeChartPeriod('3mo')">3M</button>
                        <button class="chart-period-btn" data-period="1y" onclick="changeChartPeriod('1y')">1Y</button>
                    </div>
                    <div class="chart-type-controls">
                        <button class="chart-type-btn active" data-type="line" onclick="changeChartType('line')" title="Line Chart">
                            <i class="fas fa-chart-line"></i>
                        </button>
                        <button class="chart-type-btn" data-type="candlestick" onclick="changeChartType('candlestick')" title="Candlestick Chart">
                            <i class="fas fa-chart-bar"></i>
                        </button>
                    </div>
                    <div class="chart-indicator-controls">
                        <button class="indicator-toggle-btn" data-indicator="bollinger" onclick="toggleIndicator('bollinger')" title="Bollinger Bands">BB</button>
                        <button class="indicator-toggle-btn" data-indicator="rsi" onclick="toggleIndicator('rsi')" title="RSI (14)">RSI</button>
                        <button class="indicator-toggle-btn" data-indicator="macd" onclick="toggleIndicator('macd')" title="MACD (12,26,9)">MACD</button>
                    </div>
                </div>
                <!-- Main Price Chart -->
                <div class="chart-container main-chart-container">
                    <canvas id="stockChart"></canvas>
                </div>
                <!-- RSI Chart Panel (hidden by default) -->
                <div class="indicator-panel rsi-panel" id="rsiPanel" style="display: none;">
                    <div class="indicator-header">
                        <span class="indicator-title">RSI (14)</span>
                        <span class="indicator-value" id="rsiValue">--</span>
                    </div>
                    <div class="indicator-chart-container">
                        <canvas id="rsiChart"></canvas>
                    </div>
                </div>
                <!-- MACD Chart Panel (hidden by default) -->
                <div class="indicator-panel macd-panel" id="macdPanel" style="display: none;">
                    <div class="indicator-header">
                        <span class="indicator-title">MACD (12, 26, 9)</span>
                        <span class="indicator-value" id="macdValue">--</span>
                    </div>
                    <div class="indicator-chart-container">
                        <canvas id="macdChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Company Info -->
            <div class="stock-modal-info">
                <div class="info-row">
                    <span class="info-label">Exchange:</span>
                    <span class="info-value" id="modalExchange">--</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Sector:</span>
                    <span class="info-value" id="modalSector">--</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Industry:</span>
                    <span class="info-value" id="modalIndustry">--</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Headquarters:</span>
                    <span class="info-value" id="modalHQ">--</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Employees:</span>
                    <span class="info-value" id="modalEmployees">--</span>
                </div>
            </div>
            
            <!-- Description -->
            <div class="stock-modal-description">
                <p id="modalDescription">Apple Inc. designs, manufactures, and markets smartphones, personal computers, tablets, wearables, and accessories worldwide.</p>
            </div>
            
            <!-- Related News -->
            <div class="stock-modal-news">
                <h3><i class="fas fa-newspaper"></i> Related News</h3>
                <div id="modalNewsList" class="news-list">
                    <!-- News items populated dynamically -->
                </div>
            </div>
            
            <!-- External Links -->
            <div class="stock-modal-links">
                <a id="modalWebsite" href="#" target="_blank" rel="noopener" class="stock-link">
                    <i class="fas fa-globe"></i> Website
                </a>
                <a id="modalYahooLink" href="#" target="_blank" rel="noopener" class="stock-link">
                    <i class="fab fa-yahoo"></i> Yahoo Finance
                </a>
                <a id="modalSECLink" href="#" target="_blank" rel="noopener" class="stock-link">
                    <i class="fas fa-file-alt"></i> SEC Filings
                </a>
            </div>
        </div>
    </div>

    <!-- Stock Comparison Modal -->
    <div id="compareModal" class="compare-modal" style="display: none;">
        <div class="compare-modal-overlay" onclick="closeCompareModal()"></div>
        <div class="compare-modal-content">
            <div class="compare-modal-header">
                <h2><i class="fas fa-columns"></i> Stock Comparison</h2>
                <button class="compare-modal-close" onclick="closeCompareModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="compare-ticker-input">
                <div class="compare-ticker-list" id="compareTickerList">
                    <!-- Selected tickers will appear here -->
                </div>
                <div class="compare-add-ticker">
                    <input type="text" id="compareTickerInput" placeholder="Add ticker (e.g., AAPL)" maxlength="5" onkeypress="handleCompareTickerKeypress(event)">
                    <button onclick="addComparisonTicker()"><i class="fas fa-plus"></i></button>
                </div>
                <div class="compare-hint">Add 2-4 tickers to compare. Press Enter to add.</div>
            </div>
            <div class="compare-period-select">
                <label>Period:</label>
                <select id="comparePeriod" onchange="refreshComparison()">
                    <option value="1mo">1 Month</option>
                    <option value="3mo">3 Months</option>
                    <option value="6mo">6 Months</option>
                    <option value="1y" selected>1 Year</option>
                    <option value="2y">2 Years</option>
                </select>
                <button class="btn compare-btn" onclick="runComparison()" id="runCompareBtn">
                    <i class="fas fa-chart-line"></i> Compare
                </button>
            </div>
            <div id="compareLoading" class="compare-loading" style="display: none;">
                <i class="fas fa-spinner fa-spin"></i> Loading comparison data...
            </div>
            <div id="compareResults" class="compare-results" style="display: none;">
                <div class="compare-chart-container">
                    <canvas id="compareChart"></canvas>
                </div>
                <div class="compare-metrics-table-container">
                    <table class="compare-metrics-table" id="compareMetricsTable">
                        <thead>
                            <tr id="compareMetricsHeader">
                                <th>Metric</th>
                            </tr>
                        </thead>
                        <tbody id="compareMetricsBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Search Overlay -->
    <div id="searchOverlay" class="search-overlay">
        <div class="search-container">
            <!-- Search Header -->
            <div class="search-header">
                <div class="search-input-wrapper">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="searchInput" class="search-input" placeholder="Search articles, companies, alerts..." autocomplete="off">
                    <button id="searchClearBtn" class="search-clear" title="Clear">
                        <i class="fas fa-times"></i>
                    </button>
                    <kbd class="search-kbd">ESC</kbd>
                </div>
                <button id="searchCloseBtn" class="search-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- Search Content -->
            <div class="search-content">
                <!-- Filters Sidebar -->
                <div class="search-filters">
                    <div class="filter-section">
                        <h4><i class="fas fa-filter"></i> FILTERS</h4>
                        
                        <!-- Date Range -->
                        <div class="filter-group">
                            <label class="filter-label">DATE RANGE</label>
                            <select id="searchDateRange" class="filter-select">
                                <option value="">All Time</option>
                                <option value="today">Today</option>
                                <option value="yesterday">Yesterday</option>
                                <option value="7d">Last 7 Days</option>
                                <option value="30d">Last 30 Days</option>
                                <option value="custom">Custom Range</option>
                            </select>
                            <div id="customDateRange" class="custom-date-range" style="display: none;">
                                <input type="date" id="dateFrom" class="date-input">
                                <span>to</span>
                                <input type="date" id="dateTo" class="date-input">
                            </div>
                        </div>

                        <!-- Sources -->
                        <div class="filter-group">
                            <label class="filter-label">SOURCES</label>
                            <div id="searchSources" class="filter-checkboxes">
                                <div class="loading-small">Loading sources...</div>
                            </div>
                        </div>

                        <!-- Sentiment -->
                        <div class="filter-group">
                            <label class="filter-label">SENTIMENT</label>
                            <select id="searchSentiment" class="filter-select">
                                <option value="">All</option>
                                <option value="positive">Positive</option>
                                <option value="negative">Negative</option>
                                <option value="neutral">Neutral</option>
                            </select>
                        </div>

                        <!-- Tickers -->
                        <div class="filter-group">
                            <label class="filter-label">TICKERS</label>
                            <div class="ticker-tag-input">
                                <input type="text" id="searchTickerInput" placeholder="Add ticker...">
                                <button id="addSearchTickerBtn"><i class="fas fa-plus"></i></button>
                            </div>
                            <div id="searchTickerTags" class="ticker-tags"></div>
                        </div>

                        <!-- Min Mentions (for companies) -->
                        <div class="filter-group">
                            <label class="filter-label">MIN MENTIONS</label>
                            <input type="number" id="searchMinMentions" class="number-input" min="1" value="1">
                        </div>

                        <button id="clearFiltersBtn" class="clear-filters-btn">
                            <i class="fas fa-undo"></i> Clear Filters
                        </button>
                    </div>

                    <!-- Recent Searches -->
                    <div class="filter-section recent-searches-section">
                        <h4><i class="fas fa-history"></i> RECENT</h4>
                        <div id="recentSearches" class="recent-searches-list">
                            <span class="empty-text">No recent searches</span>
                        </div>
                    </div>
                </div>

                <!-- Results Area -->
                <div class="search-results-area">
                    <!-- Tab Navigation -->
                    <div class="search-tabs">
                        <button class="search-tab active" data-tab="all">
                            <i class="fas fa-th-large"></i> ALL
                            <span id="countAll" class="result-count">0</span>
                        </button>
                        <button class="search-tab" data-tab="articles">
                            <i class="fas fa-newspaper"></i> ARTICLES
                            <span id="countArticles" class="result-count">0</span>
                        </button>
                        <button class="search-tab" data-tab="companies">
                            <i class="fas fa-building"></i> COMPANIES
                            <span id="countCompanies" class="result-count">0</span>
                        </button>
                        <button class="search-tab" data-tab="alerts">
                            <i class="fas fa-bell"></i> ALERTS
                            <span id="countAlerts" class="result-count">0</span>
                        </button>
                        
                        <div class="search-sort">
                            <select id="searchSort" class="sort-select">
                                <option value="relevance">Relevance</option>
                                <option value="date_desc">Date (Newest)</option>
                                <option value="date_asc">Date (Oldest)</option>
                                <option value="mentions">Mentions</option>
                            </select>
                        </div>
                    </div>

                    <!-- Results Content -->
                    <div class="search-results-content">
                        <div id="searchResultsList" class="search-results-list">
                            <div class="search-placeholder">
                                <i class="fas fa-search"></i>
                                <p>Start typing to search...</p>
                                <span class="search-hint">Use filters to narrow results</span>
                            </div>
                        </div>
                    </div>

                    <!-- Search Pagination -->
                    <div id="searchPagination" class="search-pagination" style="display: none;">
                        <button id="prevPageBtn" class="page-btn" disabled>
                            <i class="fas fa-chevron-left"></i> Previous
                        </button>
                        <span id="pageInfo" class="page-info">Page 1 of 1</span>
                        <button id="nextPageBtn" class="page-btn" disabled>
                            Next <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Search Footer -->
            <div class="search-footer">
                <div class="search-status">
                    <span id="searchStatus">Ready</span>
                </div>
                <div class="search-shortcuts">
                    <kbd>â†‘â†“</kbd> Navigate <kbd>Enter</kbd> Open <kbd>Esc</kbd> Close
                </div>
            </div>
        </div>
    </div>

    <!-- Stock Screener Modal -->
    <div id="screenerModal" class="screener-modal" style="display: none;">
        <div class="screener-overlay" onclick="closeScreener()"></div>
        <div class="screener-content">
            <div class="screener-header">
                <h2><i class="fas fa-filter"></i> STOCK SCREENER</h2>
                <button class="screener-close" onclick="closeScreener()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="screener-body">
                <!-- Filters Panel -->
                <div class="screener-filters">
                    <div class="filter-section-header">
                        <i class="fas fa-sliders-h"></i> FILTERS
                    </div>

                    <!-- Market Cap -->
                    <div class="screener-filter-group">
                        <label class="screener-label">MARKET CAP (Billions $)</label>
                        <div class="range-inputs">
                            <input type="number" id="screenerMinCap" class="screener-input" placeholder="Min" min="0" step="1">
                            <span class="range-separator">to</span>
                            <input type="number" id="screenerMaxCap" class="screener-input" placeholder="Max" min="0" step="1">
                        </div>
                    </div>

                    <!-- P/E Ratio -->
                    <div class="screener-filter-group">
                        <label class="screener-label">P/E RATIO</label>
                        <div class="range-inputs">
                            <input type="number" id="screenerMinPE" class="screener-input" placeholder="Min" min="0" step="0.1">
                            <span class="range-separator">to</span>
                            <input type="number" id="screenerMaxPE" class="screener-input" placeholder="Max" min="0" step="0.1">
                        </div>
                    </div>

                    <!-- Sector -->
                    <div class="screener-filter-group">
                        <label class="screener-label">SECTOR</label>
                        <select id="screenerSector" class="screener-select">
                            <option value="">All Sectors</option>
                            <option value="Technology">Technology</option>
                            <option value="Healthcare">Healthcare</option>
                            <option value="Financial Services">Financial Services</option>
                            <option value="Consumer Cyclical">Consumer Cyclical</option>
                            <option value="Consumer Defensive">Consumer Defensive</option>
                            <option value="Energy">Energy</option>
                            <option value="Industrials">Industrials</option>
                            <option value="Communication Services">Communication Services</option>
                            <option value="Basic Materials">Basic Materials</option>
                            <option value="Utilities">Utilities</option>
                            <option value="Real Estate">Real Estate</option>
                        </select>
                    </div>

                    <!-- Dividend Yield -->
                    <div class="screener-filter-group">
                        <label class="screener-label">DIVIDEND YIELD (%)</label>
                        <div class="range-inputs">
                            <input type="number" id="screenerMinDiv" class="screener-input" placeholder="Min" min="0" step="0.1">
                            <span class="range-separator">to</span>
                            <input type="number" id="screenerMaxDiv" class="screener-input" placeholder="Max" min="0" step="0.1">
                        </div>
                    </div>

                    <!-- Price Range -->
                    <div class="screener-filter-group">
                        <label class="screener-label">PRICE ($)</label>
                        <div class="range-inputs">
                            <input type="number" id="screenerMinPrice" class="screener-input" placeholder="Min" min="0" step="1">
                            <span class="range-separator">to</span>
                            <input type="number" id="screenerMaxPrice" class="screener-input" placeholder="Max" min="0" step="1">
                        </div>
                    </div>

                    <!-- Sort Options -->
                    <div class="screener-filter-group">
                        <label class="screener-label">SORT BY</label>
                        <select id="screenerSortBy" class="screener-select">
                            <option value="market_cap">Market Cap</option>
                            <option value="pe_ratio">P/E Ratio</option>
                            <option value="dividend_yield">Dividend Yield</option>
                            <option value="price">Price</option>
                            <option value="change_pct">% Change</option>
                            <option value="volume">Volume</option>
                        </select>
                    </div>

                    <div class="screener-filter-group">
                        <label class="screener-label">ORDER</label>
                        <select id="screenerSortOrder" class="screener-select">
                            <option value="desc">Descending</option>
                            <option value="asc">Ascending</option>
                        </select>
                    </div>

                    <!-- Action Buttons -->
                    <div class="screener-actions">
                        <button class="screener-btn screener-btn-primary" onclick="runScreener()">
                            <i class="fas fa-play"></i> RUN SCREENER
                        </button>
                        <button class="screener-btn screener-btn-secondary" onclick="resetScreenerFilters()">
                            <i class="fas fa-undo"></i> RESET
                        </button>
                    </div>
                </div>

                <!-- Results Panel -->
                <div class="screener-results">
                    <div class="screener-results-header">
                        <span id="screenerResultCount">0 stocks found</span>
                        <span id="screenerLoading" class="screener-loading" style="display: none;">
                            <i class="fas fa-spinner fa-spin"></i> Loading...
                        </span>
                    </div>

                    <div class="screener-table-wrapper">
                        <table class="screener-table">
                            <thead>
                                <tr>
                                    <th class="sortable" data-sort="ticker">TICKER</th>
                                    <th class="sortable" data-sort="name">NAME</th>
                                    <th class="sortable" data-sort="price">PRICE</th>
                                    <th class="sortable" data-sort="change_pct">CHG %</th>
                                    <th class="sortable" data-sort="market_cap">MKT CAP</th>
                                    <th class="sortable" data-sort="pe_ratio">P/E</th>
                                    <th class="sortable" data-sort="dividend_yield">DIV %</th>
                                    <th>SECTOR</th>
                                </tr>
                            </thead>
                            <tbody id="screenerTableBody">
                                <tr class="screener-placeholder">
                                    <td colspan="8">
                                        <div class="screener-empty">
                                            <i class="fas fa-search"></i>
                                            <p>Configure filters and click RUN SCREENER</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart.js for charts (optional) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <!-- Socket.IO for real-time price updates -->
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <!-- BlueSky Optimized Loader - Must load before dashboard.js -->
    <script src="/web/static/js/bluesky-loader-optimized.js?v=1"></script>
    <!-- Dashboard JavaScript -->
    <script src="/web/static/js/dashboard.js?v=1002"></script>
</body>
</html>
